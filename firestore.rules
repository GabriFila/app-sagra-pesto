rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
      match /sagre/{sagraId} {
      	match /services/{serviceId} {
    			allow read: if isLoggedIn() && hasRole('admin');
          allow create: if isLoggedIn() && hasRole('admin');
          allow update: if isLoggedIn() && hasRole('admin');
          allow delete: if false;
          match /orders/{orderId} {
            allow write: if false;
            allow read: if false;
          }
          match /courses/{courseId} {
            allow write: if false;
            allow read: if false;
          }
          match /instantOrders/{instantOrderId} {
          allow create: if isLoggedIn() && hasRole('cassa-istantanea') ;
          allow update: if false;
          allow delete: if false;
            allow read: if false;
          }
        }
        match /storage/{storageid} {
        	allow get: if isLoggedIn() && hasRole('admin');
          allow create: if false;
          allow update: if isLoggedIn() && hasRole('admin');
          allow delete: if false;
        }
		  	allow read: if false;
  			allow write: if false;
  
      }
      	allow read: if false;
    		allow write: if false;
  }
}


function hasRole(reqRole) {
	return request.auth.token[reqRole] == true;
}

function isLoggedIn() {
	return request.auth.uid != null;
}